import{A as e,C as t,D as n,E as r,N as i,O as a,P as o,S as s,T as c,_ as l,b as u,c as d,d as f,f as p,g as m,h,j as g,k as _,l as v,m as y,n as b,p as x,t as S,u as C,v as w,x as T,y as E}from"./index-BbLwrtR3.js";var D={class:`group-test`},ee={class:`selector_container`},te={key:0,class:`mode-select`},ne={key:1},re={key:2},ie=[`disabled`],O={key:3},k={key:0},A={class:`question-box`},j={class:`choices`},M=[`disabled`,`onClick`],N={key:1},P={key:4},ae={key:0},oe={key:5},F={key:6},I={key:7},L=y(t({__name:`GroupTestScreen`,setup(t){let y=S(),L=g(`choose`),R=g(``),z=g(`lobby`),B=g(``),V=g(``),H=g(``),U=g(!1),W=g(!1),G=g([]),K=g(0),q=g([]),J=g([]),Y=g(!1),X=g(null);function se(){let e=`ABCDEFGHIJKLMNOPQRSTUVWXYZ`;return e[Math.floor(Math.random()*26)]+e[Math.floor(Math.random()*26)]+Math.floor(100+Math.random()*900)}let Z=l(()=>G.value[K.value]||{}),Q=l(()=>[...J.value].sort((e,t)=>t.score-e.score));function ce(){let e=Z.value;if(!e||!e.term){q.value=[];return}let t=e.term;q.value=[...[...G.value.filter((e,t)=>t!==K.value)].sort(()=>Math.random()-.5).slice(0,3).map(e=>e.term),t].sort(()=>Math.random()-.5)}a([()=>K.value,()=>G.value.length,()=>z.value],()=>{z.value===`question`&&G.value.length>0&&(Y.value=!1,ce())});function $(e){let t=v(b,`group_games`,e),n=d(t,`players`);f(t,e=>{let t=e.data();t&&(z.value=t.phase||`lobby`,K.value=t.currentQuestionIndex??0,G.value=t.cards||[])}),f(n,e=>{J.value=e.docs.map(e=>e.data());let t=J.value.length>0&&J.value.every(e=>e.hasAnswered);W.value&&z.value===`question`&&t&&X.value!==K.value&&(X.value=K.value,pe())})}async function le(){if(!B.value.trim()){alert(`Please enter a nickname.`);return}if(!y.currentSetId){alert(`Select a flashcard set first.`);return}let e=y.sets.find(e=>e.id===y.currentSetId);if(!e||e.cards.length===0){alert(`Selected set has no cards.`);return}W.value=!0,L.value=`host`,G.value=[...e.cards].sort(()=>Math.random()-.5),K.value=0;let t=se();R.value=t;let n=v(b,`group_games`,t);await p(n,{host:B.value,setId:e.id,setName:e.name,cards:G.value,currentQuestionIndex:0,phase:`lobby`,createdAt:Date.now()}),await p(v(d(n,`players`),B.value),{name:B.value,score:0,hasAnswered:!1,lastAnswerCorrect:!1,lastChoice:``,answerTime:0}),U.value=!0,$(t)}async function ue(){R.value&&(await x(v(b,`group_games`,R.value),{phase:`question`,currentQuestionIndex:0}),X.value=null)}async function de(){if(!V.value.trim()||!H.value.trim()){alert(`Enter both fields.`);return}let e=V.value.trim().toUpperCase(),t=v(b,`group_games`,e),n=await C(t);if(!n.exists()){alert(`Game not found.`);return}W.value=!1,R.value=e;let r=n.data();G.value=r?.cards||[],K.value=r?.currentQuestionIndex??0,z.value=r?.phase||`lobby`,await p(v(d(t,`players`),H.value.trim()),{name:H.value.trim(),score:0,hasAnswered:!1,lastAnswerCorrect:!1,lastChoice:``,answerTime:0}),U.value=!0,$(e)}async function fe(e){if(Y.value||!R.value||z.value!==`question`)return;Y.value=!0;let t=Z.value;if(!t||!t.term)return;let n=t.term.trim().toLowerCase(),r=e.trim().toLowerCase()===n,i=W.value?B.value:H.value,a=J.value.find(e=>e.name===i),o=a?a.score:0;await x(v(b,`group_games`,R.value,`players`,i),{hasAnswered:!0,lastAnswerCorrect:r,lastChoice:e,answerTime:Date.now(),score:o})}async function pe(){if(!R.value)return;let e=v(b,`group_games`,R.value),t=d(e,`players`),n=J.value.length,r=J.value.filter(e=>e.lastAnswerCorrect).sort((e,t)=>(e.answerTime||0)-(t.answerTime||0));for(let e=0;e<r.length;e++){let i=r[e],a=Math.max(n-e,1);await x(v(t,i.name),{score:(i.score||0)+a})}await x(e,{phase:`scoreboard`}),setTimeout(async()=>{await me()},4e3)}async function me(){if(!R.value)return;let e=v(b,`group_games`,R.value),t=d(e,`players`);if(K.value+1>=G.value.length){await x(e,{phase:`finished`});return}let n=K.value+1;K.value=n,X.value=null,await x(e,{currentQuestionIndex:n,phase:`question`});for(let e of J.value)await x(v(t,e.name),{hasAnswered:!1,lastAnswerCorrect:!1,lastChoice:``,answerTime:0})}function he(){L.value=`choose`,R.value=``,V.value=``,H.value=``,B.value=``,U.value=!1,W.value=!1,z.value=`lobby`,G.value=[],K.value=0,J.value=[],q.value=[],Y.value=!1,X.value=null}return(t,a)=>{let l=n(`router-link`);return c(),u(`div`,D,[w(`nav`,ee,[s(l,{class:`SelectorCard`,to:`/`},{default:_(()=>[...a[5]||=[T(`Back`,-1)]]),_:1})]),L.value===`choose`?(c(),u(`div`,te,[a[6]||=w(`h2`,null,`Group Test`,-1),w(`button`,{onClick:a[0]||=e=>L.value=`host`},`Host Game`),w(`button`,{onClick:a[1]||=e=>L.value=`join`},`Join Game`)])):L.value===`host`&&!R.value?(c(),u(`div`,ne,[a[7]||=w(`h2`,null,`Host a Game`,-1),a[8]||=w(`p`,null,`Use your currently selected flashcard set.`,-1),e(w(`input`,{"onUpdate:modelValue":a[2]||=e=>B.value=e,class:`input`,placeholder:`Enter your nickname`},null,512),[[h,B.value]]),w(`button`,{onClick:le},`Create Game`)])):L.value===`host`&&R.value&&z.value===`lobby`?(c(),u(`div`,re,[w(`h2`,null,`Game Code: `+o(R.value),1),a[9]||=w(`p`,null,`Share this code with your friends.`,-1),a[10]||=w(`h3`,null,`Players Joined:`,-1),w(`ul`,null,[(c(!0),u(m,null,r(J.value,e=>(c(),u(`li`,{key:e.name},o(e.name)+` (score: `+o(e.score)+`)`,1))),128))]),w(`button`,{onClick:ue,disabled:J.value.length===0},`Start Game`,8,ie)])):z.value===`question`&&G.value.length>0?(c(),u(`div`,O,[w(`h2`,null,`Question `+o(K.value+1)+` / `+o(G.value.length),1),R.value?(c(),u(`p`,k,`Game Code: `+o(R.value),1)):E(``,!0),w(`div`,A,o(Z.value.definition),1),w(`div`,j,[(c(!0),u(m,null,r(q.value,e=>(c(),u(`button`,{key:e,class:`choice-button`,disabled:Y.value,onClick:t=>fe(e)},o(e),9,M))),128))]),a[11]||=w(`h3`,null,`Scores`,-1),w(`ul`,null,[(c(!0),u(m,null,r(Q.value,e=>(c(),u(`li`,{key:e.name},o(e.name)+` – `+o(e.score),1))),128))]),Y.value?(c(),u(`p`,N,`You have answered. Waiting for others...`)):E(``,!0)])):z.value===`scoreboard`?(c(),u(`div`,P,[a[12]||=w(`h2`,null,`Scoreboard`,-1),w(`p`,null,`Results for Question `+o(K.value+1),1),w(`ul`,null,[(c(!0),u(m,null,r(Q.value,e=>(c(),u(`li`,{key:e.name,class:i({correct:e.lastAnswerCorrect})},[T(o(e.name)+` – `+o(e.score)+` `,1),e.lastAnswerCorrect?(c(),u(`span`,ae,` (correct)`)):E(``,!0)],2))),128))]),a[13]||=w(`p`,null,`Next question starting soon...`,-1)])):z.value===`finished`?(c(),u(`div`,oe,[a[14]||=w(`h2`,null,`Game Finished!`,-1),a[15]||=w(`h3`,null,`Final Standings`,-1),w(`ul`,null,[(c(!0),u(m,null,r(Q.value,e=>(c(),u(`li`,{key:e.name},o(e.name)+` – `+o(e.score),1))),128))]),w(`button`,{onClick:he},`Back to Mode Select`)])):L.value===`join`&&!U.value?(c(),u(`div`,F,[a[16]||=w(`h2`,null,`Join a Game`,-1),e(w(`input`,{"onUpdate:modelValue":a[3]||=e=>V.value=e,class:`input`,placeholder:`Enter Game Code`},null,512),[[h,V.value]]),e(w(`input`,{"onUpdate:modelValue":a[4]||=e=>H.value=e,class:`input`,placeholder:`Enter Nickname`},null,512),[[h,H.value]]),w(`button`,{onClick:de},`Join`)])):L.value===`join`&&U.value&&z.value===`lobby`?(c(),u(`div`,I,[a[17]||=w(`h2`,null,`Waiting for Host to Start...`,-1),w(`p`,null,`Game Code: `+o(R.value),1),a[18]||=w(`h3`,null,`Players:`,-1),w(`ul`,null,[(c(!0),u(m,null,r(J.value,e=>(c(),u(`li`,{key:e.name},o(e.name)+` – `+o(e.score),1))),128))])])):E(``,!0)])}}}),[[`__scopeId`,`data-v-e9e19727`]]);export{L as default};